{
  "schemaVersion": "2025-10-governance-v1",
  "metadata": {
    "description": "System Governance Rules - Single Source of Truth for all governance policies",
    "lastUpdated": "2025-10-05T00:00:00.000Z",
    "maintainer": "System Governance Team"
  },
  "toolModePolicy": {
    "enabled": true,
    "description": "Type-based governance enforcement - analyze vs transform",
    "modes": {
      "analyze": {
        "requiresGovernance": false,
        "description": "Read-only operations (reports, scans, validation)",
        "examples": [
          "radar-engine",
          "gaps-engine",
          "validate-engine",
          "verify-engine",
          "inspection-engine"
        ]
      },
      "transform": {
        "requiresGovernance": true,
        "description": "Write operations (fixes, refactors, builds)",
        "examples": [
          "maintain-engine",
          "fix-engine",
          "refactor-engine",
          "optimization-engine"
        ]
      }
    },
    "enforcement": {
      "strategy": "type-based",
      "noExemptionList": true,
      "autoDetect": true,
      "marker": "@tool-mode:"
    }
  },
  "rules": [
    {
      "id": "NO_LEGACY_IMPORTS",
      "severity": "critical",
      "description": "레거시 파일 직접 실행 차단",
      "pattern": "scripts/(unified-dashboard|fix-orchestrator|smart-maintenance-orchestrator|ai-fix-engine|comprehensive-doc-updater|handoff-generator)",
      "action": "throw",
      "enabled": true,
      "enforceInCI": true,
      "message": "이 파일은 더 이상 직접 실행할 수 없습니다. 올바른 명령어를 사용하세요."
    },
    {
      "id": "INSPECT_FIRST",
      "severity": "critical",
      "description": "maintain/fix 실행 전 inspect 필수",
      "enforcedBy": "InspectionCache.enforceInspectFirst",
      "enabled": true,
      "enforceInCI": true,
      "message": "maintain/fix를 실행하기 전에 npm run status를 먼저 실행하세요."
    },
    {
      "id": "NO_BYPASS",
      "severity": "critical",
      "description": "거버넌스 우회 완전 차단",
      "flags": {
        "SKIP_GOVERNANCE": false,
        "FORCE_EXECUTION": false,
        "BYPASS_TIMEOUT": false
      },
      "enabled": true,
      "enforceInCI": true,
      "message": "거버넌스 규칙을 우회할 수 없습니다."
    },
    {
      "id": "CACHE_TTL",
      "severity": "high",
      "description": "캐시 TTL 정책 (Path 기반 구분)",
      "cacheRules": [
        {
          "type": "inspection",
          "ttlSeconds": 1800,
          "pathPattern": "reports/inspection-results\\.json$",
          "message": "Inspection 캐시가 만료되었습니다. npm run status를 재실행하세요."
        },
        {
          "type": "quality",
          "ttlSeconds": 900,
          "pathPattern": "reports/(baseline_report\\.(jsonl|md)|quality-history/.*\\.jsonl)$",
          "message": "Quality 평가 캐시가 만료되었습니다. npm run quality:assess를 재실행하세요."
        }
      ],
      "enabled": true,
      "enforceInCI": true,
      "enforcedBy": "CacheManager.enforceTTL"
    }
  ],
  "timeoutPolicy": {
    "user-input": {
      "timeout": null,
      "description": "무한 대기 허용 (사용자 승인 필요 시)",
      "examples": ["/fix 승인 대기", "interactive prompt"]
    },
    "system-command": {
      "timeout": 600000,
      "description": "10분 (600초)",
      "examples": ["npm install", "npm run build", "git operations"]
    },
    "validation": {
      "timeout": 120000,
      "description": "2분 (120초)",
      "examples": ["TypeScript 컴파일", "ESLint 검사", "테스트 실행"]
    },
    "file-operation": {
      "timeout": 30000,
      "description": "30초",
      "examples": ["파일 읽기/쓰기", "디렉토리 생성"]
    }
  },
  "loopDetection": {
    "enabled": true,
    "maxIterations": 1000,
    "maxRatePerSecond": 100,
    "whitelist": [
      "user-approval-wait",
      "interactive-fix-session",
      "retry-with-backoff",
      "self-validation"
    ],
    "alertThreshold": {
      "iterations": 500,
      "ratePerSecond": 50
    },
    "profileEnabled": true,
    "profilePath": "reports/loop-profile.json"
  },
  "notifications": {
    "enabled": true,
    "channels": ["console", "file", "slack", "github"],
    "config": {
      "slack": {
        "webhookUrl": "${SLACK_WEBHOOK_URL}",
        "channel": "#governance-alerts",
        "username": "Governance Bot"
      },
      "github": {
        "repo": "synthetic-text-agents-v2",
        "owner": "${GITHUB_OWNER}",
        "token": "${GITHUB_TOKEN}",
        "labels": ["bug", "governance", "auto-generated"]
      },
      "file": {
        "logPath": "reports/alerts",
        "maxFiles": 100,
        "rotationPolicy": "daily"
      }
    },
    "eventTypes": {
      "manifestIntegrityFailure": {
        "severity": "critical",
        "channels": ["console", "file", "slack", "github"],
        "description": "Manifest hash mismatch or corruption - governance trust chain broken",
        "action": "block-and-alert",
        "requiresImmediate": true
      },
      "infiniteLoop": {
        "severity": "critical",
        "channels": ["console", "file", "slack", "github"]
      },
      "timeout": {
        "severity": "high",
        "channels": ["console", "file", "slack"]
      },
      "unexpectedChange": {
        "severity": "high",
        "channels": ["console", "file", "github"]
      },
      "validationFailure": {
        "severity": "medium",
        "channels": ["console", "file"]
      }
    }
  },
  "snapshot": {
    "enabled": true,
    "includePaths": [
      "src/**/*.ts",
      "scripts/**/*.ts",
      "package.json",
      "tsconfig.json",
      "reports/**/*.json"
    ],
    "excludePaths": [
      "node_modules/**",
      "dist/**",
      "**/*.test.ts",
      "reports/snapshots/**",
      "reports/operations/**"
    ],
    "hashAlgorithm": "sha256",
    "retentionDays": 7
  },
  "operationLogging": {
    "enabled": true,
    "logPath": "reports/operations/governance.jsonl",
    "detailLevel": "verbose",
    "includeSnapshots": true,
    "rotationPolicy": {
      "maxSizeMB": 100,
      "maxFiles": 10
    }
  },
  "quality": {
    "enabled": true,
    "description": "Quality Assessment System Configuration (Phase 1-4)",
    "weights": {
      "questionType": 0.4,
      "answerStructure": 0.3,
      "numberFormat": 0.2,
      "prohibition": 0.1
    },
    "thresholds": {
      "guideline_compliance": 0.85,
      "retrieval_quality_score": 0.7,
      "semantic_quality": 0.75
    },
    "features": {
      "FEATURE_GUIDELINE_GATE": true,
      "FEATURE_EVIDENCE_GATE": false,
      "FEATURE_QUALITY_HYBRID_SEARCH": false,
      "FEATURE_QUALITY_RAGAS_EVAL": false
    }
  },
  "qualityLedger": {
    "enabled": true,
    "description": "품질 평가 이력 원장 (JSONL 기반)",
    "basePath": "reports/quality-history",
    "filenamePattern": "ledger-{YYYY}-{MM}-{DD}.jsonl",
    "rotationPolicy": {
      "maxSizeMB": 50,
      "retentionDays": 180,
      "autoRotate": true
    },
    "integrityCheck": {
      "enabled": true,
      "hashAlgorithm": "sha256",
      "validateOnRead": true
    },
    "schema": {
      "timestamp": "ISO 8601 string",
      "phase": "Phase 0|1|2|3|4",
      "metrics": {
        "guideline_compliance": "number | null",
        "retrieval_quality_score": "number | null",
        "semantic_quality": "number | null"
      },
      "gate_result": "PASS|WARN|PARTIAL|FAIL",
      "next_phase": "string | null",
      "session_id": "string",
      "config_version": "string",
      "hash": "SHA256 entry-level integrity hash"
    }
  },
  "qualityProtection": {
    "enabled": true,
    "policySource": "quality-policy.json",
    "description": "Quality-essential files protection (QA generation quality core)",
    "protectedFiles": [
      {
        "path": "src/agents/domainConsultant.ts",
        "reason": "도메인 지식 데이터 (QA 품질 핵심)",
        "severity": "critical",
        "autoRefactor": false,
        "requireApproval": true,
        "qualityImpact": "high"
      },
      {
        "path": "src/agents/psychologySpecialist.ts",
        "reason": "심리 분석 로직 (QA 품질 핵심)",
        "severity": "critical",
        "autoRefactor": false,
        "requireApproval": true,
        "qualityImpact": "high"
      },
      {
        "path": "src/agents/linguisticsEngineer.ts",
        "reason": "언어 최적화 로직 (QA 품질 핵심)",
        "severity": "high",
        "autoRefactor": false,
        "requireApproval": true,
        "qualityImpact": "high"
      }
    ],
    "autoCheck": {
      "enabled": true,
      "analyzer": "scripts/radar-engine.ts::analyzeFileQualityImpact",
      "onViolation": "block-refactor"
    }
  },
  "metricProtection": {
    "enabled": true,
    "description": "품질 메트릭 보호 정책 - 핵심 품질 지표의 자동 조정 제한",
    "protectedMetrics": [
      {
        "name": "guideline_compliance",
        "priority": "P0",
        "description": "가이드라인 준수율 (품질 핵심 지표)",
        "autoAdjustLimit": {
          "enabled": true,
          "minDelta": -0.05,
          "maxDelta": 0.1,
          "requireApprovalIf": {
            "deltaExceeds": 0.1,
            "absoluteValueBelow": 0.8,
            "consecutiveDrops": 3
          }
        },
        "governance": {
          "logChanges": true,
          "notifyOn": ["significant-drop", "below-threshold"],
          "thresholds": {
            "critical": 0.7,
            "warning": 0.85,
            "target": 0.95
          }
        }
      },
      {
        "name": "retrieval_quality_score",
        "priority": "P0",
        "description": "검색 품질 점수 (RAG 성능 핵심)",
        "autoAdjustLimit": {
          "enabled": true,
          "minDelta": -0.05,
          "maxDelta": 0.1,
          "requireApprovalIf": {
            "deltaExceeds": 0.1,
            "absoluteValueBelow": 0.75
          }
        },
        "governance": {
          "logChanges": true,
          "notifyOn": ["significant-drop"],
          "thresholds": {
            "critical": 0.6,
            "warning": 0.75,
            "target": 0.9
          }
        }
      },
      {
        "name": "semantic_quality",
        "priority": "P1",
        "description": "의미적 품질 점수",
        "autoAdjustLimit": {
          "enabled": true,
          "minDelta": -0.1,
          "maxDelta": 0.15,
          "requireApprovalIf": {
            "deltaExceeds": 0.15
          }
        },
        "governance": {
          "logChanges": true,
          "notifyOn": ["below-threshold"],
          "thresholds": {
            "warning": 0.7,
            "target": 0.85
          }
        }
      }
    ],
    "changeLogging": {
      "enabled": true,
      "logPath": "reports/operations/governance.jsonl",
      "includeDetails": ["oldValue", "newValue", "delta", "reason", "approver"]
    },
    "validation": {
      "enabled": true,
      "validator": "scripts/lib/governance/metric-validator.ts",
      "onViolation": "block-and-notify"
    }
  },
  "riskDomains": [
    {
      "path": "src/agents/**",
      "reason": "Agent 변경은 QA 품질에 직접 영향",
      "severity": "high",
      "requiresApproval": true,
      "autoCheck": "quality-impact-analysis"
    },
    {
      "path": "src/rag/**",
      "reason": "RAG 시스템 변경은 신중히",
      "severity": "high",
      "requiresApproval": true
    },
    {
      "path": "src/clients/**",
      "reason": "API 클라이언트 변경 위험",
      "severity": "high",
      "requiresApproval": true
    },
    {
      "path": "package.json",
      "reason": "의존성 변경 검토 필요",
      "severity": "critical",
      "requiresApproval": true
    },
    {
      "path": "scripts/lib/inspection-*.ts",
      "reason": "Inspection 코어 로직 변경 위험",
      "severity": "critical",
      "requiresApproval": true
    },
    {
      "path": "scripts/lib/governance/**",
      "reason": "거버넌스 시스템 자체 변경",
      "severity": "critical",
      "requiresApproval": true
    }
  ],
  "selfValidation": {
    "enabled": true,
    "maxRetries": 3,
    "retryDelay": 1000,
    "checks": [
      {
        "name": "TypeScript",
        "command": "npm run typecheck",
        "required": true
      },
      {
        "name": "ESLint",
        "command": "npm run lint",
        "required": false,
        "autoFix": "npm run lint:fix"
      },
      {
        "name": "Tests",
        "command": "npm run test",
        "required": false
      }
    ]
  },
  "deprecatedFiles": [
    {
      "path": "scripts/unified-dashboard.ts",
      "replacement": "npm run status",
      "reason": "캐시 기반 아키텍처로 전환",
      "deprecatedSince": "2025-10-01"
    },
    {
      "path": "scripts/fix-orchestrator.ts",
      "replacement": "npm run fix",
      "reason": "캐시 기반 아키텍처로 전환",
      "deprecatedSince": "2025-10-01"
    },
    {
      "path": "scripts/smart-maintenance-orchestrator.ts",
      "replacement": "npm run maintain",
      "reason": "캐시 기반 아키텍처로 전환",
      "deprecatedSince": "2025-10-01"
    },
    {
      "path": "scripts/ai-fix-engine.ts",
      "replacement": "npm run maintain",
      "reason": "Self-Validation으로 통합",
      "deprecatedSince": "2025-10-01"
    },
    {
      "path": "scripts/comprehensive-doc-updater.ts",
      "replacement": "npm run ship",
      "reason": "Ship 워크플로우로 통합",
      "deprecatedSince": "2025-10-01"
    },
    {
      "path": "scripts/handoff-generator.ts",
      "replacement": "npm run ship",
      "reason": "Ship 워크플로우로 통합",
      "deprecatedSince": "2025-10-01"
    }
  ]
}
