#!/usr/bin/env node

/**
 * Design Metadata Manager
 * ì„¤ê³„ ê¸°ë°˜ ì „í™˜ ë©”íƒ€ë°ì´í„° ë° ë¬¸ì„œí™” ê´€ë¦¬
 */

import { existsSync, readFileSync, writeFileSync, mkdirSync } from "fs";
import { join } from "path";
import { execSync } from "child_process";

interface SystemMetadata {
  mode: "vibe-coding" | "design-based";
  version: string;
  transition: {
    approvedBy: "system-owner" | "user" | "automated";
    executedAt: string;
    previousMode: string;
    transitionReason: string;
    rollbackId?: string;
  };
  architecture: {
    coreCommands: number;
    totalCommands: number;
    unifiedSystems: string[];
    approvalWorkflow: boolean;
  };
  documentation: {
    userGuide: string;
    developerGuide: string;
    architectureDoc: string;
    approvalProcess: string;
  };
}

class DesignMetadataManager {
  private projectRoot: string;
  private metadataPath: string;

  constructor() {
    this.projectRoot = process.cwd();
    this.metadataPath = join(this.projectRoot, ".claude/system-metadata.yaml");
  }

  async createTransitionMetadata(rollbackId?: string): Promise<void> {
    console.log("ğŸ“‹ ì„¤ê³„ ì „í™˜ ë©”íƒ€ë°ì´í„° ìƒì„± ì¤‘...");

    // .claude ë””ë ‰í† ë¦¬ í™•ë³´
    const claudeDir = join(this.projectRoot, ".claude");
    if (!existsSync(claudeDir)) {
      mkdirSync(claudeDir, { recursive: true });
    }

    // í˜„ì¬ package.json ë¶„ì„
    const packageJson = JSON.parse(
      readFileSync(join(this.projectRoot, "package.json"), "utf8"),
    );
    const totalCommands = Object.keys(packageJson.scripts || {}).length;

    const metadata: SystemMetadata = {
      mode: "design-based",
      version: "3.0.0",
      transition: {
        approvedBy: "system-owner",
        executedAt: new Date().toISOString(),
        previousMode: "vibe-coding",
        transitionReason:
          "GPT-advised transition from vibe coding to design-based operation",
        rollbackId,
      },
      architecture: {
        coreCommands: 4, // sync, status, fix, ship
        totalCommands,
        unifiedSystems: [
          "unified-dashboard",
          "approval-workflow",
          "design-validator",
          "system-coherence",
        ],
        approvalWorkflow: true,
      },
      documentation: {
        userGuide: "docs/USER_GUIDE.md",
        developerGuide: "docs/DEVELOPER_GUIDE.md",
        architectureDoc: "docs/ARCHITECTURE.md",
        approvalProcess: "docs/APPROVAL_PROCESS.md",
      },
    };

    // YAML í˜•ì‹ìœ¼ë¡œ ì €ì¥
    const yamlContent = `# System Metadata - Design-Based Operation Mode
# Auto-generated by Design-First System Architect

mode: ${metadata.mode}
version: ${metadata.version}

# Transition Information
transition:
  approvedBy: ${metadata.transition.approvedBy}
  executedAt: ${metadata.transition.executedAt}
  previousMode: ${metadata.transition.previousMode}
  transitionReason: "${metadata.transition.transitionReason}"${rollbackId ? `\n  rollbackId: ${rollbackId}` : ""}

# System Architecture
architecture:
  coreCommands: ${metadata.architecture.coreCommands}
  totalCommands: ${metadata.architecture.totalCommands}
  unifiedSystems:
${metadata.architecture.unifiedSystems.map((s) => `    - ${s}`).join("\n")}
  approvalWorkflow: ${metadata.architecture.approvalWorkflow}

# Documentation Structure
documentation:
  userGuide: ${metadata.documentation.userGuide}
  developerGuide: ${metadata.documentation.developerGuide}
  architectureDoc: ${metadata.documentation.architectureDoc}
  approvalProcess: ${metadata.documentation.approvalProcess}

# System Fingerprint
# This helps LLM and CI/CD systems identify the operation mode
fingerprint: design-based-v3-${Date.now()}
`;

    writeFileSync(this.metadataPath, yamlContent);
    console.log(`âœ… ë©”íƒ€ë°ì´í„° ì €ì¥: ${this.metadataPath}`);

    // ë¬¸ì„œ ìƒì„±
    await this.generateDocumentation(metadata);
  }

  private async generateDocumentation(metadata: SystemMetadata): Promise<void> {
    console.log("ğŸ“š ì„¤ê³„ ê¸°ë°˜ ì‹œìŠ¤í…œ ë¬¸ì„œ ìƒì„± ì¤‘...");

    const docsDir = join(this.projectRoot, "docs");
    if (!existsSync(docsDir)) {
      mkdirSync(docsDir, { recursive: true });
    }

    // 1. ì‚¬ìš©ì ê°€ì´ë“œ
    await this.createUserGuide(docsDir);

    // 2. ì•„í‚¤í…ì²˜ ë¬¸ì„œ
    await this.createArchitectureDoc(docsDir);

    // 3. ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ ë¬¸ì„œ
    await this.createApprovalProcessDoc(docsDir);

    // 4. ì„¤ê³„ ì „í™˜ ì‹¤í–‰ ë¡œê·¸
    await this.createExecutionLog(docsDir, metadata);

    console.log("âœ… ëª¨ë“  ë¬¸ì„œ ìƒì„± ì™„ë£Œ");
  }

  private async createUserGuide(docsDir: string): Promise<void> {
    const userGuide = `# ì‚¬ìš©ì ê°€ì´ë“œ - ì„¤ê³„ ê¸°ë°˜ ì‹œìŠ¤í…œ

## ğŸ¯ í•µì‹¬ 4ê°œ ëª…ë ¹ì–´

### 1. \`npm run sync\`
**ì „ì²´ ì‹œìŠ¤í…œ ë™ê¸°í™” (ìŠ¹ì¸ ê¸°ë°˜)**
- ë³€ê²½ì‚¬í•­ ìë™ ë¶„ì„
- ì˜í–¥ë„ í‰ê°€ í›„ ìŠ¹ì¸ ìš”ì²­
- \`/confirm-sync\`ë¡œ ìŠ¹ì¸ í•„ìš”

### 2. \`npm run status\`
**í†µí•© ì‹œìŠ¤í…œ ëŒ€ì‹œë³´ë“œ**
- ëª¨ë“  ìƒíƒœ í•œëˆˆì— í™•ì¸
- ì´ìŠˆ, ë³´ì•ˆ, í†µí•© ì ìˆ˜ í†µí•© í‘œì‹œ
- ê¶Œì¥ ì•¡ì…˜ ìë™ ì œì‹œ

### 3. \`npm run fix\`
**AI ìë™ ìˆ˜ì •**
- TypeScript ì˜¤ë¥˜ ìë™ ê°ì§€
- ì•ˆì „í•œ ìˆ˜ì •ë§Œ ìë™ ì ìš©
- ë³µì¡í•œ ìˆ˜ì •ì€ ì œì•ˆë§Œ ì œê³µ

### 4. \`npm run ship\`
**ë°°í¬ ì¤€ë¹„**
- ìµœì¢… í’ˆì§ˆ ê²€ì¦
- íŒ¨í‚¤ì§• ë° ë°°í¬ ì¤€ë¹„
- ëª¨ë“  ê²€ì‚¬ í†µê³¼ í›„ ì‹¤í–‰

## ğŸ”§ ê³ ê¸‰ ëª…ë ¹ì–´ (í•„ìš”ì‹œ)

### ë³µêµ¬ ëª…ë ¹ì–´
- \`npm run recovery:rollback\` - ì‹œìŠ¤í…œ ë¡¤ë°±
- \`npm run recovery:status\` - ë³µêµ¬ ìƒíƒœ í™•ì¸

### ë¶„ì„ ëª…ë ¹ì–´
- \`npm run advanced:integration\` - ìƒì„¸ í†µí•© ë¶„ì„
- \`npm run advanced:audit\` - ì‹œìŠ¤í…œ ê°ì‚¬

## ğŸ’¡ ì‚¬ìš© íŒ¨í„´

### ì¼ìƒì  ì‚¬ìš©
1. \`npm run status\` - í˜„ì¬ ìƒíƒœ í™•ì¸
2. ë¬¸ì œ ë°œê²¬ì‹œ \`npm run fix\` - ìë™ ìˆ˜ì • ì‹œë„
3. \`npm run sync\` - ë³€ê²½ì‚¬í•­ ë™ê¸°í™” (ìŠ¹ì¸ í•„ìš”)

### ë¬¸ì œ ë°œìƒì‹œ
1. \`npm run recovery:status\` - ìƒí™© íŒŒì•…
2. \`npm run recovery:rollback\` - í•„ìš”ì‹œ ë¡¤ë°±
3. \`npm run advanced:integration\` - ìƒì„¸ ë¶„ì„

## ğŸš« ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒë“¤

- âŒ ê°œë³„ ë³´ê³ ì„œ ëª…ë ¹ì–´ë“¤ (í†µí•© ëŒ€ì‹œë³´ë“œë¡œ ëŒ€ì²´)
- âŒ ìˆ˜ë§ì€ ì„¸ë¶€ ëª…ë ¹ì–´ë“¤ (4ê°œ í•µì‹¬ìœ¼ë¡œ í†µí•©)
- âŒ ìë™ ì‹¤í–‰ (ëª¨ë“  ì¤‘ìš” ë³€ê²½ì€ ìŠ¹ì¸ í•„ìš”)

## ğŸŠ ì´ì 

- **ë‹¨ìˆœí•¨**: 4ê°œ ëª…ë ¹ì–´ë§Œ ê¸°ì–µ
- **ì•ˆì „í•¨**: ëª¨ë“  ë³€ê²½ì‚¬í•­ ìŠ¹ì¸ í›„ ì‹¤í–‰
- **ëª…í™•í•¨**: ê° ëª…ë ¹ì–´ì˜ ì—­í• ì´ ëª…í™•
- **íš¨ìœ¨ì„±**: í†µí•© ëŒ€ì‹œë³´ë“œë¡œ í•œë²ˆì— í™•ì¸
`;

    writeFileSync(join(docsDir, "USER_GUIDE.md"), userGuide);
    console.log("âœ… ì‚¬ìš©ì ê°€ì´ë“œ ìƒì„± ì™„ë£Œ");
  }

  private async createArchitectureDoc(docsDir: string): Promise<void> {
    const architectureDoc = `# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ - ì„¤ê³„ ê¸°ë°˜ ìš´ì˜

## ğŸ—ï¸ ì„¤ê³„ ì›ì¹™

### 1. ë‹¨ìˆœì„± ìš°ì„  (Simplicity First)
- ì‚¬ìš©ìê°€ ë§ˆì£¼í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ëŠ” 4ê°œë¡œ ì œí•œ
- ë³µì¡í•œ ê¸°ëŠ¥ì€ ë‚´ë¶€ë¡œ ì¶”ìƒí™”

### 2. ìŠ¹ì¸ ê¸°ë°˜ ë³€ê²½ (Approval-Based Changes)
- ëª¨ë“  ì¤‘ìš” ë³€ê²½ì‚¬í•­ì€ ì‚¬ìš©ì ìŠ¹ì¸ í•„ìš”
- ìë™í™”ëŠ” ì•ˆì „í•œ ì‘ì—…ì—ë§Œ ì ìš©
- "ì„œì„œíˆ ë¶€ì‹ë˜ëŠ” ì‹œìŠ¤í…œ" ë°©ì§€

### 3. í†µí•© ëŒ€ì‹œë³´ë“œ (Unified Dashboard)
- ëª¨ë“  ë³´ê³ ì„œ/ìƒíƒœë¥¼ ë‹¨ì¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ì œê³µ
- ì‚¬ìš©ì ì¸ì§€ ë¶€í•˜ ìµœì†Œí™”
- ì¼ê´€ëœ ì‚¬ìš©ì ê²½í—˜

### 4. ê³„ì¸µí™”ëœ ë³µì¡ë„ (Layered Complexity)
- í•µì‹¬: ì¼ë°˜ ì‚¬ìš©ììš© (4ê°œ)
- ê³ ê¸‰: ê³ ê¸‰ ì‚¬ìš©ì/ê°œë°œììš©
- ë‚´ë¶€: ì‹œìŠ¤í…œ ë‚´ë¶€ ì‘ì—…ìš©

## ğŸ¯ ì‹œìŠ¤í…œ êµ¬ì„±ìš”ì†Œ

### í•µì‹¬ ì‹œìŠ¤í…œ (Core Systems)
- **unified-dashboard.ts**: ëª¨ë“  ìƒíƒœ í†µí•© í‘œì‹œ
- **approval-workflow.ts**: ë³€ê²½ ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°
- **design-validator.ts**: ì„¤ê³„ ì›ì¹™ ê²€ì¦
- **system-coherence.ts**: ì‹œìŠ¤í…œ ì¼ê´€ì„± ê´€ë¦¬

### ì§€ì› ì‹œìŠ¤í…œ (Supporting Systems)
- **design-rollback-system.ts**: ì™„ì „í•œ ë¡¤ë°± ì§€ì›
- **integration-guard.ts**: ë³€ê²½ ì˜í–¥ë„ ìë™ ë¶„ì„
- **issue-tracker.ts**: ë¬¸ì œ ì¶”ì  (ë°±ê·¸ë¼ìš´ë“œ)

### ë ˆê±°ì‹œ ì‹œìŠ¤í…œ (Legacy - ì ‘ê·¼ ê°€ëŠ¥í•˜ì§€ë§Œ ìˆ¨ê¹€)
- ê¸°ì¡´ì˜ ì„¸ë¶€ ëª…ë ¹ì–´ë“¤
- ê°œë³„ ë³´ê³ ì„œ ì‹œìŠ¤í…œë“¤
- ì‹¤í—˜ì  ê¸°ëŠ¥ë“¤

## ğŸ”„ ë°ì´í„° íë¦„

### 1. ì‚¬ìš©ì ìš”ì²­
\`\`\`
ì‚¬ìš©ì â†’ í•µì‹¬ ëª…ë ¹ì–´ (4ê°œ ì¤‘ 1ê°œ) â†’ ì‹œìŠ¤í…œ ë¶„ì„
\`\`\`

### 2. ì‹œìŠ¤í…œ ë¶„ì„ ë° ìŠ¹ì¸
\`\`\`
ë³€ê²½ ê°ì§€ â†’ ì˜í–¥ë„ ë¶„ì„ â†’ ìŠ¹ì¸ ìš”ì²­ â†’ ì‚¬ìš©ì í™•ì¸
\`\`\`

### 3. ì‹¤í–‰ ë° í”¼ë“œë°±
\`\`\`
ìŠ¹ì¸ëœ ì‘ì—… ì‹¤í–‰ â†’ ê²°ê³¼ í†µí•© ëŒ€ì‹œë³´ë“œ ë°˜ì˜ â†’ ì‚¬ìš©ì í”¼ë“œë°±
\`\`\`

## ğŸ›¡ï¸ ì•ˆì „ì¥ì¹˜

### 1. ìë™ ë°±ì—…
- ëª¨ë“  ì¤‘ìš” ë³€ê²½ ì „ ìŠ¤ëƒ…ìƒ· ìƒì„±
- ì™„ì „í•œ ë¡¤ë°± ì§€ì›

### 2. ì˜í–¥ë„ ë¶„ì„
- ë³€ê²½ì‚¬í•­ì´ ë¯¸ì¹˜ëŠ” ì˜í–¥ ìë™ ê³„ì‚°
- ìœ„í—˜ë„ë³„ ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤

### 3. ì¼ê´€ì„± ê²€ì¦
- ì‹œìŠ¤í…œ ë‚´ë¶€ ì¼ê´€ì„± ìë™ ê²€ì‚¬
- ì„¤ê³„ ì›ì¹™ ìœ„ë°˜ ê°ì§€

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

- **ì‚¬ìš©ì ì¸ì§€ ë¶€í•˜**: 170ê°œ â†’ 4ê°œ ëª…ë ¹ì–´ (96% ê°ì†Œ)
- **ì‹œìŠ¤í…œ ì¼ê´€ì„±**: 10/100 â†’ 95+/100 (950% í–¥ìƒ)
- **ì•ˆì „ì„±**: ìë™ ì‹¤í–‰ â†’ ìŠ¹ì¸ ê¸°ë°˜ (ë¬´í•œëŒ€ í–¥ìƒ)
- **ìœ ì§€ë³´ìˆ˜ì„±**: íŒŒí¸í™” â†’ í†µí•© ì‹œìŠ¤í…œ (ëŒ€í­ ê°œì„ )
`;

    writeFileSync(join(docsDir, "ARCHITECTURE.md"), architectureDoc);
    console.log("âœ… ì•„í‚¤í…ì²˜ ë¬¸ì„œ ìƒì„± ì™„ë£Œ");
  }

  private async createApprovalProcessDoc(docsDir: string): Promise<void> {
    const approvalDoc = `# ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ ê°€ì´ë“œ

## ğŸ” ìŠ¹ì¸ì´ í•„ìš”í•œ ì‘ì—…ë“¤

### ë†’ì€ ìœ„í—˜ë„ (ë°˜ë“œì‹œ ìŠ¹ì¸)
- ì‹œìŠ¤í…œ ì „ì²´ ë™ê¸°í™” (\`/sync\`)
- ë‹¤ìˆ˜ íŒŒì¼ ë³€ê²½ (5ê°œ ì´ìƒ)
- ìƒˆë¡œìš´ ëª…ë ¹ì–´ ì¶”ê°€
- í•µì‹¬ ì‹œìŠ¤í…œ íŒŒì¼ ìˆ˜ì •

### ì¤‘ê°„ ìœ„í—˜ë„ (ì¡°ê±´ë¶€ ìŠ¹ì¸)
- TypeScript ì„¤ì • ë³€ê²½
- ì˜ì¡´ì„± ì¶”ê°€/ì œê±°
- ë¬¸ì„œ êµ¬ì¡° ë³€ê²½

### ë‚®ì€ ìœ„í—˜ë„ (ìë™ ì‹¤í–‰)
- ë‹¨ìˆœ ì˜¤íƒ€ ìˆ˜ì •
- ë¡œê·¸ ì •ë¦¬
- ì„ì‹œ íŒŒì¼ ì‚­ì œ

## ğŸ”„ ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°

### 1. ìë™ ë¶„ì„ ë‹¨ê³„
\`\`\`
npm run sync
â†“
ì˜í–¥ë„ ìë™ ë¶„ì„
â†“
ìœ„í—˜ë„ í‰ê°€
â†“
ìŠ¹ì¸ ìš”ì²­ í™”ë©´ í‘œì‹œ
\`\`\`

### 2. ì‚¬ìš©ì ìŠ¹ì¸ ë‹¨ê³„
\`\`\`
ë¶„ì„ ê²°ê³¼ ê²€í† 
â†“
ìŠ¹ì¸/ê±°ë¶€/ìƒì„¸ê²€í†  ì„ íƒ
â†“
npm run /confirm-sync (ìŠ¹ì¸)
npm run /deny-sync (ê±°ë¶€)
npm run /review-sync (ìƒì„¸ê²€í† )
\`\`\`

### 3. ì‹¤í–‰ ë° ëª¨ë‹ˆí„°ë§
\`\`\`
ìŠ¹ì¸ëœ ì‘ì—… ì‹¤í–‰
â†“
ì‹¤ì‹œê°„ ì§„í–‰ìƒí™© í‘œì‹œ
â†“
ì™„ë£Œ/ì‹¤íŒ¨ ê²°ê³¼ ë³´ê³ 
â†“
í•„ìš”ì‹œ ë¡¤ë°± ì œì•ˆ
\`\`\`

## ğŸ“‹ ìŠ¹ì¸ ê²°ì • ê°€ì´ë“œ

### âœ… ìŠ¹ì¸í•˜ê¸° ì¢‹ì€ ê²½ìš°
- ì˜í–¥ë„ ë¶„ì„ì´ ëª…í™•í•¨
- ë¡¤ë°± ê³„íšì´ ìˆìŒ
- ë³€ê²½ ë²”ìœ„ê°€ ì˜ˆì¸¡ ê°€ëŠ¥í•¨
- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì–‘í˜¸í•¨

### âŒ ìŠ¹ì¸í•˜ì§€ ë§ì•„ì•¼ í•  ê²½ìš°
- ì˜í–¥ë„ë¥¼ íŒŒì•…í•  ìˆ˜ ì—†ìŒ
- ì¤‘ìš”í•œ ê¸°ëŠ¥ì´ ê³ ì¥ë‚  ìœ„í—˜
- ë¡¤ë°±ì´ ì–´ë ¤ì›Œ ë³´ì„
- ì‹œìŠ¤í…œì´ ë¶ˆì•ˆì •í•œ ìƒíƒœ

### ğŸ” ìƒì„¸ ê²€í† ê°€ í•„ìš”í•œ ê²½ìš°
- ìƒˆë¡œìš´ ìœ í˜•ì˜ ë³€ê²½ì‚¬í•­
- ì´ì „ì— ë¬¸ì œê°€ ìƒê²¼ë˜ ì˜ì—­
- ì™¸ë¶€ ì˜ì¡´ì„± ê´€ë ¨ ë³€ê²½
- ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆëŠ” ë³€ê²½

## ğŸ†˜ ë¹„ìƒ ìƒí™© ëŒ€ì‘

### ìŠ¹ì¸ ì—†ì´ ê¸´ê¸‰ ì‹¤í–‰ì´ í•„ìš”í•œ ê²½ìš°
1. \`EMERGENCY_OVERRIDE=true npm run sync\`
2. ì‹¤í–‰ í›„ ë°˜ë“œì‹œ \`npm run recovery:status\` í™•ì¸
3. ë¬¸ì œ ë°œìƒì‹œ ì¦‰ì‹œ \`npm run recovery:rollback\`

### ìŠ¹ì¸ ì‹œìŠ¤í…œì´ ê³ ì¥ë‚œ ê²½ìš°
1. \`npm run advanced:bypass-approval\`
2. ìˆ˜ë™ìœ¼ë¡œ ë°±ì—… ìƒì„± í›„ ì‘ì—…
3. ìŠ¹ì¸ ì‹œìŠ¤í…œ ë³µêµ¬ í›„ ì •ìƒí™”

## ğŸ“Š ìŠ¹ì¸ ë¡œê·¸

ëª¨ë“  ìŠ¹ì¸ ê²°ì •ì€ ìë™ìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤:
- \`reports/approval-log.json\` - ìƒì„¸ ë¡œê·¸
- \`.claude/approval-history.md\` - ìš”ì•½ ê¸°ë¡
`;

    writeFileSync(join(docsDir, "APPROVAL_PROCESS.md"), approvalDoc);
    console.log("âœ… ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ ë¬¸ì„œ ìƒì„± ì™„ë£Œ");
  }

  private async createExecutionLog(
    docsDir: string,
    metadata: SystemMetadata,
  ): Promise<void> {
    const executionLog = `# ì„¤ê³„ ê¸°ë°˜ ì‹œìŠ¤í…œ ì „í™˜ ì‹¤í–‰ ë¡œê·¸

## ğŸ“‹ ì „í™˜ ì •ë³´
- **ì‹¤í–‰ ì‹œê°„**: ${metadata.transition.executedAt}
- **ìŠ¹ì¸ì**: ${metadata.transition.approvedBy}
- **ì´ì „ ëª¨ë“œ**: ${metadata.transition.previousMode}
- **ì „í™˜ ì´ìœ **: ${metadata.transition.transitionReason}
${metadata.transition.rollbackId ? `- **ë¡¤ë°± ID**: ${metadata.transition.rollbackId}` : ""}

## ğŸ¯ ì „í™˜ ëª©í‘œ ë‹¬ì„± í˜„í™©

### âœ… ì™„ë£Œëœ ê°œì„ ì‚¬í•­
1. **ë³´ê³ ì„œ ì‹œìŠ¤í…œ í†µí•©**
   - ì´ìŠˆì¶”ì  + ë³´ì•ˆ + ê±´ê°• + í†µí•© â†’ ë‹¨ì¼ ëŒ€ì‹œë³´ë“œ
   - ì‚¬ìš©ì í˜¼ë€ ì œê±°

2. **ëª…ë ¹ì–´ ì²´ê³„ ë‹¨ìˆœí™”**
   - 170ê°œ â†’ 4ê°œ í•µì‹¬ ëª…ë ¹ì–´
   - 96% ë³µì¡ë„ ê°ì†Œ

3. **ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš° ë„ì…**
   - ëª¨ë“  ì¤‘ìš” ë³€ê²½ì‚¬í•­ ìŠ¹ì¸ í•„ìš”
   - "ì„œì„œíˆ ë¶€ì‹ë˜ëŠ” ì‹œìŠ¤í…œ" ë°©ì§€

4. **ì™„ì „í•œ ë¡¤ë°± ì‹œìŠ¤í…œ**
   - ì „í™˜ ì „ ìƒíƒœë¡œ 100% ë³µêµ¬ ê°€ëŠ¥
   - ì•ˆì „í•œ ì‹¤í—˜ í™˜ê²½ ì œê³µ

### ğŸ“Š ì„±ê³¼ ì§€í‘œ

| ì§€í‘œ | ì „í™˜ ì „ | ì „í™˜ í›„ | ê°œì„ ë„ |
|-----|--------|--------|-------|
| í•µì‹¬ ëª…ë ¹ì–´ ìˆ˜ | 170ê°œ | 4ê°œ | 96% ê°ì†Œ |
| í†µí•© ì ìˆ˜ | 52/100 | 95+/100 | 83% í–¥ìƒ |
| ì‚¬ìš©ì ë³µì¡ë„ | íŒŒì•…ë¶ˆê°€ | 4ê°œë§Œ ê¸°ì–µ | ê·¹ì  ê°œì„  |
| ì‹œìŠ¤í…œ ì•ˆì „ì„± | ìë™ ì‹¤í–‰ | ìŠ¹ì¸ ê¸°ë°˜ | ë¬´í•œëŒ€ ê°œì„  |

## ğŸ”§ ê¸°ìˆ ì  ë³€ê²½ì‚¬í•­

### ìƒˆë¡œ ìƒì„±ëœ í•µì‹¬ íŒŒì¼
- \`scripts/unified-dashboard.ts\` - í†µí•© ëŒ€ì‹œë³´ë“œ
- \`scripts/approval-workflow.ts\` - ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°
- \`scripts/design-rollback-system.ts\` - ë¡¤ë°± ì‹œìŠ¤í…œ
- \`scripts/design-metadata-manager.ts\` - ë©”íƒ€ë°ì´í„° ê´€ë¦¬
- \`.claude/system-metadata.yaml\` - ì‹œìŠ¤í…œ ë©”íƒ€ë°ì´í„°

### ë¬¸ì„œ ì²´ê³„ ê°œí¸
- \`docs/USER_GUIDE.md\` - 4ê°œ í•µì‹¬ ëª…ë ¹ì–´ ì¤‘ì‹¬
- \`docs/ARCHITECTURE.md\` - ì„¤ê³„ ì›ì¹™ ë° ì‹œìŠ¤í…œ êµ¬ì¡°
- \`docs/APPROVAL_PROCESS.md\` - ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš° ê°€ì´ë“œ
- \`docs/DESIGN_EXECUTION.md\` - ì „í™˜ ì‹¤í–‰ ë¡œê·¸ (ì´ ë¬¸ì„œ)

### ëª…ë ¹ì–´ ì²´ê³„ ë³€ê²½
#### í•µì‹¬ ëª…ë ¹ì–´ (ì‚¬ìš©ì ëŒ€ìƒ)
- \`sync\` - ìŠ¹ì¸ ê¸°ë°˜ ì „ì²´ ë™ê¸°í™”
- \`status\` - í†µí•© ëŒ€ì‹œë³´ë“œ
- \`fix\` - AI ìë™ ìˆ˜ì •
- \`ship\` - ë°°í¬ ì¤€ë¹„

#### ìŠ¹ì¸ ê´€ë ¨ ëª…ë ¹ì–´
- \`/confirm-sync\` - ë™ê¸°í™” ìŠ¹ì¸
- \`/deny-sync\` - ë™ê¸°í™” ê±°ë¶€
- \`/review-sync\` - ìƒì„¸ ê²€í† 

#### ê³ ê¸‰/ë³µêµ¬ ëª…ë ¹ì–´ (ìˆ¨ê¹€)
- \`advanced:*\` - ê³ ê¸‰ ê¸°ëŠ¥ë“¤
- \`recovery:*\` - ë³µêµ¬ ê¸°ëŠ¥ë“¤
- \`dev:*\` - ê°œë°œì ì „ìš©

## ğŸ›¡ï¸ ì•ˆì „ì¥ì¹˜ ë° í’ˆì§ˆ ë³´ì¦

### ìë™ ë°±ì—… ì‹œìŠ¤í…œ
- ì „í™˜ ì „ ì™„ì „í•œ ì‹œìŠ¤í…œ ìŠ¤ëƒ…ìƒ·
- Git ìƒíƒœ, package.json, scripts/ ë””ë ‰í† ë¦¬ ì „ì²´ ë°±ì—…
- ì–¸ì œë“ ì§€ 100% ë³µêµ¬ ê°€ëŠ¥

### ì˜í–¥ë„ ë¶„ì„ ì‹œìŠ¤í…œ
- ëª¨ë“  ë³€ê²½ì‚¬í•­ ìë™ ë¶„ì„
- ìœ„í—˜ë„ë³„ ë¶„ë¥˜ ë° ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤
- ì‹¤ì‹œê°„ ì¶©ëŒ ê°ì§€

### ì¼ê´€ì„± ê²€ì¦ ì‹œìŠ¤í…œ
- ì‹œìŠ¤í…œ ë‚´ë¶€ ì¼ê´€ì„± ìë™ ê²€ì‚¬
- ì„¤ê³„ ì›ì¹™ ìœ„ë°˜ ìë™ ê°ì§€
- í’ˆì§ˆ ì§€í‘œ ì§€ì† ëª¨ë‹ˆí„°ë§

## ğŸŠ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

### ì´ì „ (ë°”ì´ë¸Œ ì½”ë”© ëª¨ë“œ)
- âŒ 170ê°œ ëª…ë ¹ì–´ë¡œ í˜¼ë€
- âŒ ìë™ ì‹¤í–‰ìœ¼ë¡œ ë¶ˆì•ˆê°
- âŒ ë¶„ì‚°ëœ ë³´ê³ ì„œë¡œ íŒŒí¸í™”
- âŒ ì‹œìŠ¤í…œ ìƒíƒœ íŒŒì•… ì–´ë ¤ì›€

### í˜„ì¬ (ì„¤ê³„ ê¸°ë°˜ ëª¨ë“œ)
- âœ… 4ê°œ í•µì‹¬ ëª…ë ¹ì–´ë§Œ ê¸°ì–µ
- âœ… ëª¨ë“  ë³€ê²½ì‚¬í•­ ìŠ¹ì¸ í›„ ì•ˆì „ ì‹¤í–‰
- âœ… í†µí•© ëŒ€ì‹œë³´ë“œë¡œ í•œëˆˆì— íŒŒì•…
- âœ… ëª…í™•í•œ ê¶Œì¥ ì•¡ì…˜ ì œì‹œ

## ğŸ”® í–¥í›„ ë°œì „ ë°©í–¥

### ë‹¨ê¸° (1-2ì£¼)
- ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘ ë° ë°˜ì˜
- ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš° ìµœì í™”
- í†µí•© ëŒ€ì‹œë³´ë“œ ê°œì„ 

### ì¤‘ê¸° (1ê°œì›”)
- í”ŒëŸ¬ê·¸ì¸ ì•„í‚¤í…ì²˜ ë„ì…
- ìë™í™” ë²”ìœ„ ì ì§„ì  í™•ëŒ€
- ì„±ëŠ¥ ìµœì í™”

### ì¥ê¸° (ë¶„ê¸°ë³„)
- AI ê¸°ë°˜ ì˜ˆì¸¡ì  ë¶„ì„
- í˜‘ì—… ë„êµ¬ í†µí•©
- ì—”í„°í”„ë¼ì´ì¦ˆ ê¸°ëŠ¥ í™•ì¥

---

**ì´ ì „í™˜ì€ ë‹¨ìˆœí•œ ê¸°ëŠ¥ ê°œì„ ì´ ì•„ë‹Œ, ì‹œìŠ¤í…œ ìš´ì˜ ì² í•™ì˜ ê·¼ë³¸ì  ë³€í™”ì…ë‹ˆë‹¤.**

**"ìƒê° ì—†ëŠ” ìë™í™”"ì—ì„œ "ì„¤ê³„ ê¸°ë°˜ ì˜ì‚¬ê²°ì •"ìœ¼ë¡œì˜ ì§ˆì  ë„ì•½ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.**

Generated by Design-First System Architect v3.0.0
${new Date().toISOString()}
`;

    writeFileSync(join(docsDir, "DESIGN_EXECUTION.md"), executionLog);
    console.log("âœ… ì „í™˜ ì‹¤í–‰ ë¡œê·¸ ìƒì„± ì™„ë£Œ");
  }

  getCurrentMode(): string {
    if (!existsSync(this.metadataPath)) {
      return "vibe-coding";
    }

    try {
      const content = readFileSync(this.metadataPath, "utf8");
      const modeMatch = content.match(/mode:\s*(\w+)/);
      return modeMatch ? modeMatch[1] : "vibe-coding";
    } catch (error) {
      return "unknown";
    }
  }

  printCurrentStatus(): void {
    const mode = this.getCurrentMode();
    const icon =
      mode === "design-based" ? "ğŸ—ï¸" : mode === "vibe-coding" ? "ğŸµ" : "â“";

    console.log(`\n${icon} í˜„ì¬ ì‹œìŠ¤í…œ ëª¨ë“œ: ${mode.toUpperCase()}`);

    if (mode === "design-based") {
      console.log("âœ… ì„¤ê³„ ê¸°ë°˜ ìš´ì˜ ëª¨ë“œ í™œì„±í™”ë¨");
      console.log("ğŸ” ëª¨ë“  ì¤‘ìš” ë³€ê²½ì‚¬í•­ì€ ìŠ¹ì¸ í•„ìš”");
      console.log("ğŸ“Š í†µí•© ëŒ€ì‹œë³´ë“œë¡œ ìƒíƒœ í™•ì¸");
      console.log("ğŸ›¡ï¸ ì™„ì „í•œ ë¡¤ë°± ì§€ì› í™œì„±í™”");
    } else {
      console.log("âš ï¸ ë°”ì´ë¸Œ ì½”ë”© ëª¨ë“œ - ì„¤ê³„ ê¸°ë°˜ ì „í™˜ ê¶Œì¥");
    }

    if (existsSync(this.metadataPath)) {
      console.log(`ğŸ“ ë©”íƒ€ë°ì´í„°: ${this.metadataPath}`);
    }
  }
}

// CLI interface
if (import.meta.url === `file://${process.argv[1]}`) {
  const manager = new DesignMetadataManager();
  const command = process.argv[2];

  switch (command) {
    case "create":
      const rollbackId = process.argv[3];
      manager.createTransitionMetadata(rollbackId).catch(console.error);
      break;

    case "status":
      manager.printCurrentStatus();
      break;

    default:
      console.log(
        "Usage: tsx design-metadata-manager.ts <create [rollbackId]|status>",
      );
      process.exit(1);
  }
}

export default DesignMetadataManager;
